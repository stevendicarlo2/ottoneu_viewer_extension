<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ottoneu Game State Formatting Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .game-details-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .game-details-table th,
        .game-details-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .game-details-table th {
            background-color: #f1f3f4;
            font-weight: bold;
        }
        .smaller {
            font-size: 0.85em;
            color: #666;
        }
        .green {
            color: #28a745;
        }
        .red {
            color: #dc3545;
        }
        .blue {
            color: #007bff;
        }
        .game-page-points {
            font-weight: normal;
            text-align: center;
        }
        .button-container {
            margin: 20px 0;
            text-align: center;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .status-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .status-info h3 {
            margin-top: 0;
            color: #0056b3;
        }

        /* Bench player styles */
        .bench-player {
            opacity: 0.7 !important;
            background-color: #f8f9fa !important;
            transition: opacity 0.3s ease !important;
        }

        .bench-player:hover {
            opacity: 0.9 !important;
        }

        .bench-player .game-page-points {
            color: #6c757d !important;
            font-style: italic !important;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Ottoneu Game State Formatting Test</h1>

        <div class="status-info">
            <h3>Expected Behavior:</h3>
            <ul>
                <li><strong>Games Not Started:</strong> Player names and scores are <strong>bold</strong>, scores show "--" instead of 0.00</li>
                <li><strong>Games Completed (W/L/T):</strong> Player names and scores are normal weight, shows actual points (including 0.00 if they scored 0)</li>
                <li><strong>BYE Week:</strong> Player names normal, scores show "--"</li>
                <li><strong>Bench Players:</strong> Entire row is faded (70% opacity) with light gray background
                    <ul>
                        <li>If game not started/BYE: show "--"</li>
                        <li>If game completed: show actual score (including 0.00 if they scored 0)</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="button-container">
            <button onclick="applyFormatting()">Apply Formatting</button>
            <button onclick="resetFormatting()">Reset Formatting</button>
            <button onclick="testStability()">Test Stability</button>
        </div>

        <!-- Copy the sample table here for testing -->
        <table class="game-details-table">
            <thead>
                <tr>
                    <th class="stats-details game-page-home-team-text">Stats</th>
                    <th class="game-page-home-team-text">Player</th>
                    <th class="game-details-points game-page-home-team-text">Pts</th>
                    <th class="game-details-position">Pos</th>
                    <th class="game-details-points game-page-away-team-text">Pts</th>
                    <th class="game-page-away-team-text">Player</th>
                    <th class="stats-details game-page-away-team-text">Stats</th>
                </tr>
            </thead>
            <tbody>
                <!-- Game not started vs Game completed -->
                <tr>
                    <td class="player-stat-details game-page-home-team-text player-stat-details-11818"></td>
                    <td class="home-team-position-player game-page-home-team-text" data-position="QB" data-player-id="11818">
                        <span class="player-link-desktop">
                            <a href="#">C.J. Stroud</a> <span class="smaller">HOU QB</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only">Sun 1:00pm DEN</span>
                        </span>
                    </td>
                    <td class="game-page-home-team-text game-page-points player-points-11818">0.00</td>
                    <td class="game-details-position">
                        <span class="position">QB</span>
                    </td>
                    <td class="game-page-away-team-text game-page-points player-points-7326">25.56</td>
                    <td class="away-team-position-player game-page-away-team-text" data-position="QB" data-player-id="7326">
                        <span class="player-link-desktop">
                            <a href="#">Lamar Jackson</a> <span class="smaller">BAL QB</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only"><strong class="green">W</strong> 28-6 @MIA</span>
                        </span>
                    </td>
                    <td class="player-stat-details game-page-away-team-text">18-23 204yds 4TD<br>5rush 14yds<br></td>
                </tr>

                <!-- Both games not started -->
                <tr>
                    <td class="player-stat-details game-page-home-team-text player-stat-details-6524"></td>
                    <td class="home-team-position-player game-page-home-team-text" data-position="RB" data-player-id="6524">
                        <span class="player-link-desktop">
                            <a href="#">Christian McCaffrey</a> <span class="smaller">SF RB</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only">Sun 1:00pm @NYG</span>
                        </span>
                    </td>
                    <td class="game-page-home-team-text game-page-points player-points-6524">0.00</td>
                    <td class="game-details-position">
                        <span class="position">RB</span>
                    </td>
                    <td class="game-page-away-team-text game-page-points player-points-14164">0.00</td>
                    <td class="away-team-position-player game-page-away-team-text" data-position="RB" data-player-id="14164">
                        <span class="player-link-desktop">
                            <a href="#">TreVeyon Henderson</a> <span class="smaller">NE RB</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only">Sun 1:00pm ATL</span>
                        </span>
                    </td>
                    <td class="player-stat-details game-page-away-team-text"></td>
                </tr>

                <!-- BYE week example -->
                <tr>
                    <td class="player-stat-details game-page-home-team-text player-stat-details-9625"></td>
                    <td class="home-team-position-player game-page-home-team-text" data-position="WR" data-player-id="9625">
                        <span class="player-link-desktop">
                            <a href="#">DeVonta Smith</a> <span class="smaller">PHI WR</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only">BYE</span>
                        </span>
                    </td>
                    <td class="game-page-home-team-text game-page-points player-points-9625">0.00</td>
                    <td class="game-details-position">
                        <span class="position">WR</span>
                    </td>
                    <td class="game-page-away-team-text game-page-points player-points-13053">0.00</td>
                    <td class="away-team-position-player game-page-away-team-text" data-position="RB" data-player-id="13053">
                        <span class="player-link-desktop">
                            <a href="#">Jaylen Wright</a> <span class="smaller">MIA RB</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only"><strong class="red">L</strong> 6-28 BAL</span>
                        </span>
                    </td>
                    <td class="player-stat-details game-page-away-team-text"></td>
                </tr>

                <!-- Tie game example -->
                <tr>
                    <td class="player-stat-details game-page-home-team-text player-stat-details-9999"></td>
                    <td class="home-team-position-player game-page-home-team-text" data-position="QB" data-player-id="9999">
                        <span class="player-link-desktop">
                            <a href="#">Test Quarterback</a> <span class="smaller">TIE QB</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only"><strong class="blue">T</strong> 21-21 @HOME</span>
                        </span>
                    </td>
                    <td class="game-page-home-team-text game-page-points player-points-9999">15.75</td>
                    <td class="game-details-position">
                        <span class="position">QB</span>
                    </td>
                    <td class="game-page-away-team-text game-page-points player-points-8888">0.00</td>
                    <td class="away-team-position-player game-page-away-team-text" data-position="RB" data-player-id="8888">
                        <span class="player-link-desktop">
                            <a href="#">Bench RB Who Played</a> <span class="smaller">TIE RB</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only"><strong class="blue">T</strong> 21-21 HOME</span>
                        </span>
                    </td>
                    <td class="player-stat-details game-page-away-team-text">0 carries 0yds</td>
                </tr>

                <!-- Bench player example -->
                <tr>
                    <td class="player-stat-details game-page-home-team-text player-stat-details-1552"></td>
                    <td class="home-team-position-player game-page-home-team-text" data-position="Bench" data-player-id="1552">
                        <span class="player-link-desktop">
                            <a href="#">Tyrod Taylor</a> <span class="smaller">NYJ QB</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only">BYE</span>
                        </span>
                    </td>
                    <td class="game-page-home-team-text game-page-points player-points-1552">0.00</td>
                    <td class="game-details-position">
                        <span class="position">BN</span>
                    </td>
                    <td class="game-page-away-team-text game-page-points player-points-9126">0.00</td>
                    <td class="away-team-position-player game-page-away-team-text" data-position="Bench" data-player-id="9126">
                        <span class="player-link-desktop">
                            <a href="#">Tyler Huntley</a> <span class="smaller">BAL QB</span>
                        </span>
                        <br>
                        <span class="player-game-info smaller">
                            <span class="desktop-only"><strong class="green">W</strong> 28-6 @MIA</span>
                        </span>
                    </td>
                    <td class="player-stat-details game-page-away-team-text"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // Simulate the extension's formatting logic for testing
        function determineGameStatus(gameInfoElement) {
            const gameText = gameInfoElement.textContent.trim();

            // Check for completed games (W, L, or T with score)
            if (gameText.includes('W ') || gameText.includes('L ') || gameText.includes('T ')) {
                return 'completed';
            }

            // Check for BYE week
            if (gameText.includes('BYE')) {
                return 'bye';
            }

            // Check for future games (contains day and time)
            if (/\w{3}\s+\d{1,2}:\d{2}(am|pm)/i.test(gameText)) {
                return 'not-started';
            }

            return 'unknown';
        }

        function checkIfPlayerOnBench(playerCell, row) {
            // Check data-position attribute
            const position = playerCell.getAttribute('data-position');
            if (position && position.toLowerCase() === 'bench') {
                return true;
            }

            // Check position text content
            const positionCell = row.querySelector('.game-details-position .position');
            if (positionCell) {
                const positionText = positionCell.textContent.trim().toLowerCase();
                if (positionText === 'bn' || positionText === 'bench') {
                    return true;
                }
            }

            // Check for bench-related class names
            if (playerCell.classList.contains('bench-player') ||
                row.classList.contains('bench-row')) {
                return true;
            }

            return false;
        }

        function applyBenchPlayerFormatting(row, playerCell, pointsCell) {
            // Store the original score if not already stored
            if (!pointsCell.hasAttribute('data-original-score')) {
                const originalScore = pointsCell.textContent.trim();
                // Only store if it's a valid score (not already modified)
                if (originalScore !== '--' && originalScore !== '') {
                    pointsCell.setAttribute('data-original-score', originalScore);
                }
            }

            // Get the original score
            const originalScore = pointsCell.getAttribute('data-original-score') || pointsCell.textContent.trim();

            // Remove other formatting classes first
            playerCell.classList.remove('game-completed', 'game-not-started', 'game-bye');
            pointsCell.classList.remove('game-completed', 'game-not-started', 'game-bye');
            row.classList.remove('game-completed', 'game-not-started', 'game-bye');

            // Add bench styling to the entire row
            row.classList.add('bench-player');

            // Also add to individual cells for specificity
            playerCell.classList.add('bench-player');
            pointsCell.classList.add('bench-player');

            // Reset player link styles that might conflict
            const playerLinks = playerCell.querySelectorAll('.player-link-desktop a, .player-link-mobile a');
            playerLinks.forEach(link => {
                link.style.fontWeight = '';
            });

            // Reset inline styles
            pointsCell.style.fontWeight = '';
            pointsCell.style.fontStyle = '';
            pointsCell.style.color = '';

            // Handle bench player score display
            // Only show -- for bench players if they haven't played (games not started)
            // If they actually scored 0 points, show the 0
            const gameInfo = playerCell.querySelector('.player-game-info');
            if (gameInfo) {
                const gameStatus = determineGameStatus(gameInfo);
                if (gameStatus === 'not-started' || gameStatus === 'bye') {
                    // Game hasn't started or is BYE - show --
                    const numericScore = parseFloat(originalScore);
                    if (numericScore === 0) {
                        pointsCell.textContent = '--';
                        pointsCell.style.fontStyle = 'italic';
                        pointsCell.style.color = '#6c757d';
                    } else {
                        pointsCell.textContent = originalScore;
                    }
                } else {
                    // Game completed - show actual score (including 0 if they scored 0)
                    pointsCell.textContent = originalScore;
                }
            } else {
                // No game info available - assume not started, show -- for zero scores
                const numericScore = parseFloat(originalScore);
                if (numericScore === 0) {
                    pointsCell.textContent = '--';
                    pointsCell.style.fontStyle = 'italic';
                    pointsCell.style.color = '#6c757d';
                } else {
                    pointsCell.textContent = originalScore;
                }
            }
        }

        function applyPlayerFormatting(playerCell, pointsCell, gameStatus) {
            // Get the row element for bench formatting cleanup
            const row = playerCell.closest('tr');

            // Store the original score if not already stored
            if (!pointsCell.hasAttribute('data-original-score')) {
                const originalScore = pointsCell.textContent.trim();
                // Only store if it's a valid score (not already modified)
                if (originalScore !== '--' && originalScore !== '') {
                    pointsCell.setAttribute('data-original-score', originalScore);
                }
            }

            // Get the original score
            const originalScore = pointsCell.getAttribute('data-original-score') || pointsCell.textContent.trim();

            // Remove existing formatting classes (including bench)
            playerCell.classList.remove('game-completed', 'game-not-started', 'game-bye', 'bench-player');
            pointsCell.classList.remove('game-completed', 'game-not-started', 'game-bye', 'bench-player');
            if (row) row.classList.remove('bench-player');

            // Reset inline styles
            pointsCell.style.fontWeight = '';
            pointsCell.style.fontStyle = '';
            pointsCell.style.color = '';

            // Reset player link styles
            const playerLinks = playerCell.querySelectorAll('.player-link-desktop a, .player-link-mobile a');
            playerLinks.forEach(link => {
                link.style.fontWeight = '';
            });

            // Apply formatting based on game status
            switch (gameStatus) {
                case 'completed':
                    // Completed games - keep normal weight
                    playerCell.classList.add('game-completed');
                    pointsCell.classList.add('game-completed');

                    // Restore original score (no bold styling)
                    pointsCell.textContent = originalScore;
                    break;

                case 'not-started':
                    // Active players - make bold and add styling for games not started
                    playerCell.classList.add('game-not-started');
                    pointsCell.classList.add('game-not-started');

                    // Make player links bold for active players
                    playerLinks.forEach(link => {
                        link.style.fontWeight = 'bold';
                    });

                    // Replace score with "--" for unstarted games (only if score is 0 or 0.00)
                    const numericScore = parseFloat(originalScore);
                    if (numericScore === 0) {
                        pointsCell.textContent = '--';
                        pointsCell.style.fontStyle = 'italic';
                        pointsCell.style.color = '#6c757d';
                        pointsCell.style.fontWeight = 'bold';
                    } else {
                        // Keep the actual score if it's not zero, but make it bold
                        pointsCell.textContent = originalScore;
                        pointsCell.style.fontWeight = 'bold';
                    }
                    break;

                case 'bye':
                    // Style for BYE week players
                    playerCell.classList.add('game-bye');
                    pointsCell.classList.add('game-bye');

                    // Replace score with "--" for BYE players (only if score is 0 or 0.00)
                    const byeScore = parseFloat(originalScore);
                    if (byeScore === 0) {
                        pointsCell.textContent = '--';
                        pointsCell.style.fontStyle = 'italic';
                        pointsCell.style.color = '#6c757d';
                    } else {
                        pointsCell.textContent = originalScore;
                    }
                    break;

                default:
                    // Unknown status - restore original score
                    pointsCell.textContent = originalScore;
                    break;
            }
        }

        function processPlayerInRow(row, teamSide) {
            let playerCell, pointsCell;

            if (teamSide === 'home') {
                playerCell = row.querySelector('.home-team-position-player');
                pointsCell = row.querySelector('.game-page-home-team-text.game-page-points');
            } else {
                playerCell = row.querySelector('.away-team-position-player');
                pointsCell = row.querySelector('.game-page-away-team-text.game-page-points');
            }

            if (!playerCell || !pointsCell) return;

            // Check if player is on bench
            const isOnBench = checkIfPlayerOnBench(playerCell, row);

            if (isOnBench) {
                applyBenchPlayerFormatting(row, playerCell, pointsCell);
                return; // Skip game status formatting for bench players
            }

            const gameInfo = playerCell.querySelector('.player-game-info');
            if (!gameInfo) return;

            const gameStatus = determineGameStatus(gameInfo);

            // Apply formatting based on game status
            applyPlayerFormatting(playerCell, pointsCell, gameStatus);
        }

        function applyFormatting() {
            const gameDetailsTables = document.querySelectorAll('.game-details-table');

            gameDetailsTables.forEach(table => {
                const rows = table.querySelectorAll('tbody tr');

                rows.forEach(row => {
                    // Process both home and away players in each row
                    processPlayerInRow(row, 'home');
                    processPlayerInRow(row, 'away');
                });
            });
        }

        function resetFormatting() {
            // Reset all formatting and clear stored original scores
            const allCells = document.querySelectorAll('.home-team-position-player, .away-team-position-player, .game-page-points');
            allCells.forEach(cell => {
                cell.classList.remove('game-completed', 'game-not-started', 'game-bye', 'bench-player');
                cell.style.fontWeight = '';
                cell.style.fontStyle = '';
                cell.style.color = '';

                // Reset player links
                const links = cell.querySelectorAll('a');
                links.forEach(link => {
                    link.style.fontWeight = '';
                });

                // Reset points text and clear stored original scores
                if (cell.classList.contains('game-page-points')) {
                    if (cell.hasAttribute('data-original-score')) {
                        cell.textContent = cell.getAttribute('data-original-score');
                        cell.removeAttribute('data-original-score');
                    } else if (cell.textContent.trim() === '--') {
                        cell.textContent = '0.00';
                    }
                }
            });

            // Also reset row-level bench formatting
            const allRows = document.querySelectorAll('tr');
            allRows.forEach(row => {
                row.classList.remove('bench-player');
            });
        }

        // Test multiple applications to demonstrate stability
        function testStability() {
            console.log('Testing stability - applying formatting multiple times...');
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    console.log(`Application ${i + 1}`);
                    applyFormatting();
                }, i * 200);
            }
        }
    </script>
</body>
</html>